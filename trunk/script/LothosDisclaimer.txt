Script based on code written by Lothos, do not copy or use without his express permission